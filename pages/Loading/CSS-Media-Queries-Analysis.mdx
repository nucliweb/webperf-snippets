import snippet from '../../snippets/Loading/CSS-Media-Queries-Analysis.js?raw'
import { Snippet } from '../../components/Snippet'

# CSS Media Queries Analysis

Analyze all `@media` rules in CSS stylesheets to identify classes and properties targeting viewports bigger than a specified breakpoint (default: 768px). Results are grouped by inline CSS and external files, with byte size estimates for potential mobile savings.

This page provides two complementary analysis functions:

1. **`analyzeCSSMediaQueries(minWidth)`** - Identifies desktop-specific CSS and calculates byte savings
2. **`analyzeCSSPerformanceImpact(minWidth)`** - Estimates real-world performance impact across device profiles, including Core Web Vitals effects, render-blocking time, and business impact projections

### Snippet

<Snippet code={snippet} />

### Understanding the Results

#### `analyzeCSSMediaQueries()` Results

This function provides a detailed breakdown of desktop-specific CSS:

**Potential Mobile Savings:**

- **Estimated bytes** that mobile devices don't need to download/process
- Breakdown by inline CSS vs external files
- This represents CSS that could be eliminated from mobile experience by splitting files

**Inline CSS (`<style>` tags):**

- Number of @media rules targeting viewports larger than the specified breakpoint
- Total CSS class selectors in inline media queries
- Total CSS properties in inline media queries
- Total byte size of inline media queries

**External Files (`.css` files):**

- Number of @media rules targeting viewports larger than the specified breakpoint
- Total CSS class selectors in external file media queries
- Total CSS properties in external file media queries
- Total byte size of external file media queries

**Each media query includes:**

- **source**: Stylesheet URL or inline style tag identifier
- **mediaQuery**: The media query condition (e.g., `min-width: 1024px`)
- **classes**: Number of CSS class selectors
- **properties**: Number of CSS properties
- **bytesFormatted**: Size of the CSS in bytes (KB/MB)

#### `analyzeCSSPerformanceImpact()` Results

This function estimates the real-world performance cost on mobile devices:

**Performance Impact Analysis (per device profile):**

- **High-end devices** (Pixel 7, iPhone 14): Fast CSS parsing, good network
- **Mid-range devices** (Moto G Power, iPhone SE): Median mobile performance
- **Low-end devices** (Moto E, older devices): Slower parsing and network

For each profile, you'll see:

- **Render-blocking impact**: Network download + CSS parsing + CSSOM construction time
- **Runtime overhead**: Selector matching + style recalculation per interaction
- **Core Web Vitals impact**: FCP delay, LCP delay, INP overhead, TBT contribution

**Potential Savings:**

- Total render-blocking time that could be eliminated
- INP reduction per interaction
- Bandwidth savings
- Implementation strategy recommendations

**Memory Impact:**

- Estimated CSSOM memory overhead
- Total unnecessary memory allocation
- Impact on low-end devices

**Business Impact Estimation:**

- FCP improvement estimate
- Potential conversion lift based on Google/Deloitte research (100ms FCP â‰ˆ 1% conversion increase)

### Customizing the Breakpoint

By default, the snippet uses **768px** as the mobile breakpoint, but you can customize it:

```js copy
// Analyze media queries bigger than 1024px (desktop)
analyzeCSSMediaQueries(1024);

// Analyze media queries bigger than 480px (small tablets)
analyzeCSSMediaQueries(480);

// Analyze media queries bigger than 1440px (large desktop)
analyzeCSSMediaQueries(1440);
```

### Breakpoint Detection

The snippet considers a media query "bigger than the breakpoint" when:

- `min-width` is greater than the specified value (in px, em, or rem)
- Excludes `max-width` only queries (typically for smaller viewports)
- Automatically converts em/rem units (assuming 16px base font size)

### Solutions & Optimization Strategies

Understanding how much CSS is dedicated to larger viewports helps identify optimization opportunities:

**1. Split CSS by Media Query**

- Separate mobile and desktop CSS into different files
- Load desktop CSS with a media query: `<link media="(min-width: 768px)" href="desktop.css">`
- Reduces initial CSS parse time on mobile devices
- Reduces style recalculation work (browser doesn't need to process desktop styles)

**2. Inline Critical Above-the-Fold CSS**

- Move critical mobile CSS inline in `<style>` tags
- Defer non-critical and desktop CSS loading
- Improves First Contentful Paint (FCP) and Largest Contentful Paint (LCP) on mobile

**3. Use CSS-in-JS or CSS Modules**

- Modern bundlers can split CSS by route/component
- Only load CSS when needed (code splitting)
- Reduces unused CSS on initial load

**4. Consider Mobile-First Approach**

- Write base styles for mobile without media queries
- Use `min-width` media queries for progressive enhancement
- Reduces CSS overhead on mobile devices

**5. Audit and Remove Unused Desktop CSS**

- If desktop media queries contain excessive classes/properties
- Use tools like PurgeCSS or UnCSS to remove unused selectors
- Reduces overall CSS bundle size

**6. Measure the Impact**

- The "Potential Mobile Savings" metric shows exactly how many bytes mobile users could save
- Compare this against your total CSS size to understand the optimization opportunity
- Even 20-50 KB savings can improve mobile performance significantly

### Further Reading

For an in-depth understanding of CSS and network performance optimization strategies, check out this excellent article:

ðŸ“– [CSS and Network Performance](https://csswizardry.com/2018/11/css-and-network-performance/) by [Harry Roberts](https://bsky.app/profile/csswizardry.com) (CSS Wizardry)

This article covers:

- How CSS blocks rendering and impacts performance
- Strategies for optimizing CSS delivery
- Using media queries to conditionally load CSS
- Measuring and improving CSS performance

### Note

_Cross-origin stylesheets cannot be accessed due to CORS restrictions. The snippet will warn about these and skip them._
