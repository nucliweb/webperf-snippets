import snippet from '../../snippets/Loading/SSR-Hydration-Data-Analysis.js?raw'
import { Snippet } from '../../components/Snippet'

# SSR Framework Hydration Data Analysis

Analyzes hydration data scripts used by SSR frameworks like Next.js, Nuxt, Remix, Gatsby, and others. These scripts contain serialized state that the client needs to "hydrate" the server-rendered HTML into an interactive application.

**Supported frameworks:**

| Framework | Script ID / Pattern | Typical Content |
|-----------|--------------------| ----------------|
| **Next.js** | `#__NEXT_DATA__` | Page props, router state, build info |
| **Nuxt 3** | `#__NUXT_DATA__` | Payload, state, config |
| **Nuxt 2** | Pattern: `window.__NUXT__` | SSR state, error info |
| **Remix** | `#__remixContext` | Loader data, routes |
| **Gatsby** | `#___gatsby` + page-data | Static query results |
| **SvelteKit** | `#__sveltekit_data` | Load function data |
| **Astro** | `astro-island` props | Component props |

**Why hydration data matters:**

| Issue | Impact | Threshold |
|-------|--------|-----------|
| **Large payload** | Slower TTFB, longer parsing | > 128 KB |
| **Duplicate data** | Same data in HTML + hydration | Any duplication |
| **Unused props** | Data fetched but never rendered | Varies |
| **Sensitive data** | Exposed in client bundle | Any secrets |

> **Warning:** Everything in hydration scripts is visible to users. Never include API keys, tokens, or sensitive data in server-side props.

> **Next.js limit:** Next.js warns when `__NEXT_DATA__` exceeds 128 KB. Large payloads delay hydration and increase Time to Interactive.

### Snippet

<Snippet code={snippet} />

### Understanding the Results

**Summary Section:**
- Detected framework(s) with size and status
- Green (ðŸŸ¢) = within limits, Red (ðŸ”´) = exceeds threshold
- Total hydration data vs other inline scripts

**Framework-Specific Analysis:**

For **Next.js**, the snippet analyzes:
- Build ID and page route
- `pageProps` breakdown by key with size percentages
- Visual bars showing which props consume the most space
- Detection of large arrays, deep nesting, and potential sensitive data

For **Astro**, shows:
- Number of islands
- Client directive for each (load, idle, visible, etc.)
- Props size per island

**Common Issues Detected:**

| Issue | Why It Matters |
|-------|----------------|
| Large arrays (50+ items) | Should be paginated |
| Deep nesting (> 5 levels) | Increases parsing time |
| Sensitive data patterns | Security risk - visible to users |

### Recommended Thresholds

| Framework | Recommended Max | Official Warning |
|-----------|-----------------|------------------|
| Next.js | 128 KB | Yes, shows warning |
| Nuxt | 100 KB | No official limit |
| Remix | 100 KB | No official limit |
| Gatsby | 100 KB | No official limit |
| Astro | 50 KB total props | No official limit |

### Common Optimization Patterns

**Pagination:**
```js
// âŒ Bad: All items in initial props
export async function getServerSideProps() {
  const allItems = await fetchAllItems(); // 500 items
  return { props: { items: allItems } };
}

// âœ… Good: Paginated
export async function getServerSideProps() {
  const items = await fetchItems({ limit: 10 });
  return { props: { items, hasMore: true } };
}
```

**Selective fields:**
```js
// âŒ Bad: Full objects
return { props: { users } }; // Each user has 50 fields

// âœ… Good: Only needed fields
return {
  props: {
    users: users.map(({ id, name, avatar }) => ({ id, name, avatar })),
  },
};
```

### Further Reading

- [Next.js: Large Page Data warning](https://nextjs.org/docs/messages/large-page-data) | Next.js Docs
- [Nuxt: Reducing Payload Size](https://nuxt.com/docs/getting-started/data-fetching#reducing-payload-size) | Nuxt Docs
- [Remix: Performance](https://remix.run/docs/en/main/guides/performance) | Remix Docs
- [Astro: Islands Architecture](https://docs.astro.build/en/concepts/islands/) | Astro Docs
- [Understanding Hydration](https://www.joshwcomeau.com/react/the-perils-of-rehydration/) | Josh W. Comeau
