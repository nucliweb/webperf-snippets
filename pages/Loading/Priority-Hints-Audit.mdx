import snippet from '../../snippets/Loading/Priority-Hints-Audit.js?raw'
import { Snippet } from '../../components/Snippet'

# Priority Hints Audit

### Overview

Audits all `fetchpriority` attribute usage across the page — covering non-image resources (scripts, preload links, iframes), `fetchpriority="low"` analysis, and conflicts between `preload` and low priority. Identifies the LCP candidate when it lacks `fetchpriority="high"`.

> **Related:** Use the [Find Images With Lazy and Fetchpriority](/Loading/Find-Images-With-Lazy-and-Fetchpriority) snippet to detect the specific `loading="lazy"` + `fetchpriority="high"` conflict on images.

**What this snippet checks:**

| Check | Scope |
|-------|-------|
| Non-image resources with `fetchpriority` | `<script>`, `<link>`, `<iframe>` |
| `<link rel="preload">` + `fetchpriority="low"` | Contradictory combination |
| `fetchpriority="low"` on early-loaded resources | Possible misconfiguration |
| `fetchpriority="high"` on late-loaded resources | Investigate blocking dependencies |
| LCP candidate image without `fetchpriority="high"` | Missed LCP optimization |

**Why `fetchpriority` needs validation:**

`fetchpriority` was introduced in 2022 and hints to the browser how to prioritize a resource fetch relative to others of the same type. Incorrect usage sends conflicting signals:

| Combination | Problem |
|-------------|---------|
| `rel="preload"` + `fetchpriority="low"` | `preload` declares a resource as critical for the current page; `low` contradicts that |
| `fetchpriority="low"` on a resource loaded in the first 500ms | If it loads that early, the browser may already consider it critical |
| `fetchpriority="high"` on a resource loaded after 3s | High priority did not help — investigate render-blocking dependencies |
| LCP image without `fetchpriority="high"` | Missed opportunity to improve Largest Contentful Paint |

### Snippet

<Snippet code={snippet} />

### Understanding the Results

**Inventory Section:**

| Field | Description |
|-------|-------------|
| Total elements | All elements with a `fetchpriority` attribute |
| Images | Excluded from non-image checks (see related snippet) |
| Non-image resources | `<script>`, `<link>`, `<iframe>` with `fetchpriority` |
| Preloads with fetchpriority | `<link rel="preload">` that also set priority |
| Priority breakdown | Count of `high`, `low`, and `auto` values |

**Non-Image Resources Table:**

| Column | Description |
|--------|-------------|
| Tag | Element tag and key attributes (`rel`, `as`) |
| Priority | The `fetchpriority` value set |
| Start (ms) | When the browser started fetching (from Performance API) |
| Size (KB) | Decompressed resource size |
| Resource | Filename extracted from the URL |

**Preload Links Table:**

| Column | Description |
|--------|-------------|
| fetchpriority | Value set on the preload link |
| as | Resource type (`font`, `image`, `script`, etc.) |
| Status | `✅ Good` (high), `⚠️ Conflict` (low), `ℹ️ Auto` |
| Start (ms) | Load start time from the Performance API |
| Resource | Filename |

**Issues Detected:**

| Issue | Severity | Explanation |
|-------|----------|-------------|
| `preload` + `fetchpriority="low"` | Error | Contradictory signals — remove or change to `high` |
| `fetchpriority="low"` loaded in &lt;500ms | Warning | Resource may be more critical than declared |
| `fetchpriority="high"` loaded after 3000ms | Warning | High priority did not help — investigate dependencies |
| LCP candidate without `fetchpriority="high"` | Warning | Missed opportunity to improve LCP |

### Best Practices

**LCP image** — always set `fetchpriority="high"`:

```html
<img src="hero.webp" fetchpriority="high" alt="Hero image">
```

**Preloaded critical resource** — pair `preload` with `fetchpriority="high"`:

```html
<link rel="preload" href="critical-font.woff2" as="font" fetchpriority="high" crossorigin>
```

**Below-fold image** — `loading="lazy"` with optional `fetchpriority="low"`:

```html
<img src="gallery.jpg" loading="lazy" fetchpriority="low" alt="Gallery image">
```

**Never combine `preload` with `fetchpriority="low"`:**

```html
<!-- ❌ Contradictory -->
<link rel="preload" href="font.woff2" as="font" fetchpriority="low">

<!-- ✅ Correct -->
<link rel="preload" href="font.woff2" as="font" fetchpriority="high" crossorigin>
```

### Further Reading

- [Optimizing resource loading with Priority Hints](https://web.dev/articles/fetch-priority) | web.dev
- [fetchpriority attribute](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/fetchPriority) | MDN
- [Resource priorities in Chrome](https://web.dev/articles/resource-priority) | web.dev
- [Optimizing LCP](https://web.dev/articles/optimize-lcp) | web.dev
