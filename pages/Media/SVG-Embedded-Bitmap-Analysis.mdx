import snippet from '../../snippets/Media/SVG-Embedded-Bitmap-Analysis.js?raw'
import { Snippet } from '../../components/Snippet'

# SVG Embedded Bitmap Analysis

Scans all SVG resources on the page ‚Äî both external files and inline `<svg>` elements ‚Äî and flags any that contain embedded bitmap images, reporting name, transfer size, compression encoding, and embedded bitmap details.

**What this snippet detects:**

| Check                                               | Scope                                        |
| --------------------------------------------------- | -------------------------------------------- |
| Inline base64 bitmaps (PNG, JPEG, WebP, AVIF, GIF‚Ä¶) | External SVG files + inline `<svg>` elements |
| External bitmap references via `<image href="">`    | External SVG files + inline `<svg>` elements |
| Transfer size                                       | External SVG files                           |
| Compression encoding (gzip, br, zstd, none)         | External SVG files                           |

### Overview

SVG is a vector format designed to scale without quality loss. Embedding raster (bitmap) images inside an SVG ‚Äî either as base64 data URIs or as external `<image>` references pointing to bitmap files ‚Äî introduces several performance problems:

- **Size bloat**: Base64 encoding inflates a bitmap by approximately 33%. A 100 KB PNG becomes ~133 KB of inline text, and the wrapping SVG cannot be compressed independently.
- **No format negotiation**: The embedded bitmap is served as-is; the browser cannot substitute it with AVIF or WebP based on the `Accept` header.
- **Broken caching**: A change to either the SVG or the bitmap invalidates the other file's cache entry.
- **Blocked parallel loading**: The bitmap cannot be fetched in parallel with the SVG ‚Äî it is hidden inside it and only discovered after the SVG has been downloaded and parsed.

The correct pattern is to reference bitmap assets as separate files:

```html
<!-- ‚ùå Bitmap baked into SVG ‚Äî one large, hard-to-optimize resource -->
<img src="infographic.svg" />
<!-- infographic.svg contains: <image href="data:image/png;base64,iVBORw0K‚Ä¶"> -->

<!-- ‚úÖ Bitmap served independently ‚Äî cached and optimised separately -->
<img src="infographic.svg" />
<!-- infographic.svg references: <image href="chart.avif" width="800" height="600"/> -->
```

### Snippet

<Snippet code={snippet} />

### Understanding the Results

#### Summary

| Field                   | Description                                                                                               |
| ----------------------- | --------------------------------------------------------------------------------------------------------- |
| External SVG files      | Count of SVG resources captured by the Performance API (loaded via `<img>`, `<object>`, CSS, fetch, etc.) |
| Inline `<svg>` elements | Count of `<svg>` elements present in the DOM. When some already use the sprite pattern the breakdown shows `N using <use>, M standalone` |
| SVGs with bitmaps       | SVGs (external or inline) that contain at least one embedded bitmap                                       |

#### External SVG Resources Table

| Column            | Description                                                                                                                                                                            |
| ----------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `name`            | Filename extracted from the resource URL                                                                                                                                               |
| `size`            | Bytes transferred over the network (compressed). `‚Äî` means the entry was served from cache with no transfer                                                                            |
| `compression`     | Encoding reported by the `Content-Encoding` response header. Falls back to comparing `encodedBodySize` vs `decodedBodySize` from the Performance API when the header is not accessible |
| `embedded bitmap` | ‚úÖ none ‚Äî no bitmaps detected ¬∑ ‚ö†Ô∏è N found ‚Äî N embedded bitmaps                                                                                                                        |

#### Compression Values

| Value        | Meaning                                                    |
| ------------ | ---------------------------------------------------------- |
| `gzip`       | Compressed with GZIP                                       |
| `br`         | Compressed with Brotli                                     |
| `zstd`       | Compressed with Zstandard                                  |
| `none`       | No content encoding applied                                |
| `compressed` | Compressed (type not accessible ‚Äî CORS restriction)        |
| `cached`     | Resource was served from cache with no transfer size       |
| `N/A`        | Not applicable (inline `<svg>` element ‚Äî no HTTP transfer) |

#### Embedded Bitmap Types

| Icon | Kind       | Description                                                                                                                                                                |
| ---- | ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| üñºÔ∏è   | `inline`   | Base64-encoded bitmap embedded directly as a `data:image/‚Ä¶;base64,` URI. The reported size is an estimate derived from the base64 string length                            |
| üîó   | `external` | Bitmap file referenced via `href` or `xlink:href` on an `<image>` element. The bitmap is a separate HTTP request, but it is still discovered only after the SVG has loaded |

#### SVG Sprite Opportunity

When 5 or more standalone inline `<svg>` elements are detected (i.e. not already using `<use>`), the snippet shows a tip suggesting the SVG sprite pattern.

Inline SVGs repeated across a page inflate HTML size and cannot be cached independently. The sprite pattern defines each icon once as a `<symbol>` in a hidden `<svg>` block and references it anywhere with `<use href="#id">`:

```html
<!-- Define once (hidden, ideally in a separate .svg file loaded via fetch or server-side include) -->
<svg hidden>
  <symbol id="icon-arrow" viewBox="0 0 24 24">‚Ä¶</symbol>
  <symbol id="icon-close" viewBox="0 0 24 24">‚Ä¶</symbol>
</svg>

<!-- Use anywhere, any number of times -->
<svg aria-hidden="true"><use href="#icon-arrow"/></svg>
<svg aria-hidden="true"><use href="#icon-close"/></svg>
```

The summary line for inline `<svg>` elements shows a breakdown when the sprite pattern is already partially in use:

```
Inline <svg> elements : 211  (5 using <use>, 206 standalone)
```

> **CORS note**: The snippet fetches each SVG with `cache: "force-cache"` to read headers and content without triggering new network requests. Cross-origin SVGs without CORS headers cannot be read ‚Äî in that case the snippet falls back to Performance API timing data for size and compression, and bitmap detection is skipped for that resource.

### Further Reading

- [SVG `<image>` element](https://developer.mozilla.org/en-US/docs/Web/SVG/Element/image) | MDN
- [SVG `<use>` element](https://developer.mozilla.org/en-US/docs/Web/SVG/Element/use) | MDN
- [Data URLs](https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URLs) | MDN
- [SVGOMG](https://jakearchibald.github.io/svgomg/) | jakearchibald.github.io
- [SVGO](https://github.com/svg/svgo) | GitHub
- [Image Element Audit](/Media/Image-Element-Audit) | webperf-snippets
