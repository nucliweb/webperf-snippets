import snippet from '../../snippets/Media/Video-Element-Audit.js?raw'
import { Snippet } from '../../components/Snippet'

# Video Element Audit

Audits all `<video>` elements on the page against video performance best practices ‚Äî covering preload strategy, autoplay configuration, format modernisation, CLS prevention, and playback accessibility.

**What this snippet checks:**

| Check                                            | Scope                           |
| ------------------------------------------------ | ------------------------------- |
| `preload="auto"` without `autoplay`              | All non-autoplay videos         |
| Off-viewport video without `preload="none"`      | Below-the-fold videos           |
| `autoplay` without `muted`                       | Autoplay videos                 |
| `autoplay` without `playsinline`                 | Autoplay videos                 |
| Missing `poster` attribute                       | All videos                      |
| Missing `width` / `height` attributes            | All videos (CLS risk)           |
| No modern codec source (WebM / VP9 / AV1)        | All videos with `<source>` tags |
| No `controls` and no `autoplay`                  | Non-autoplay videos             |

### Overview

Every video on a page falls into one of three roles, each with its own optimal configuration:

**Autoplay hero / background video** ‚Äî silent, looping visual that plays immediately:

```html
<video autoplay muted playsinline loop poster="preview.avif" width="1280" height="720">
  <source src="hero.av1.webm" type="video/webm; codecs=av01.0.04M.08" />
  <source src="hero.vp9.webm" type="video/webm; codecs=vp9" />
  <source src="hero.mp4" type="video/mp4" />
</video>
```

> `muted` is required for `autoplay` to work in browsers. `playsinline` prevents iOS Safari from switching to fullscreen. Offering AV1 ‚Üí VP9 ‚Üí MP4 fallback ensures the best available codec is used, reducing file size by up to 50 % compared to H.264.

**User-controlled video** ‚Äî on-demand content the user initiates:

```html
<video controls preload="metadata" poster="thumbnail.avif" width="800" height="450">
  <source src="video.vp9.webm" type="video/webm; codecs=vp9" />
  <source src="video.mp4" type="video/mp4" />
</video>
```

> `preload="metadata"` loads only the video duration and dimensions ‚Äî enough to render the player UI ‚Äî without downloading the full file. `poster` provides a visible thumbnail while the video is paused.

**Below-the-fold video** ‚Äî content outside the initial viewport:

```html
<video controls preload="none" poster="thumbnail.avif" width="800" height="450">
  <source src="video.vp9.webm" type="video/webm; codecs=vp9" />
  <source src="video.mp4" type="video/mp4" />
</video>
```

> `preload="none"` prevents the browser from fetching any video data until the user scrolls to it or presses play. Combined with `poster`, the element still renders a visible thumbnail with no wasted bandwidth.

### Snippet

<Snippet code={snippet} />

### Understanding the Results

#### Summary

| Field        | Description                                                                  |
| ------------ | ---------------------------------------------------------------------------- |
| Total videos | Count of all `<video>` elements on the page                                  |
| In viewport  | Videos visible in the current viewport                                       |
| Off viewport | Videos outside the current viewport                                          |
| Issues       | Count by severity: errors (must fix), warnings (should fix), info (consider) |

#### All Videos Table

| Column       | Description                                                                                |
| ------------ | ------------------------------------------------------------------------------------------ |
| `src`        | Filename extracted from `currentSrc` (what the browser actually loaded)                    |
| `codec`      | Best codec detected from `<source type>` attributes or file extension                      |
| `viewport`   | ‚úì if currently visible                                                                     |
| `preload`    | `none` ¬∑ `metadata` ¬∑ `auto` ¬∑ `(not set)` (browser default: `metadata` on desktop)       |
| `autoplay`   | ‚úì if `autoplay` attribute is present                                                       |
| `muted`      | ‚úì if `muted` attribute is present or `video.muted` is true                                 |
| `playsinline`| ‚úì if `playsinline` attribute is present                                                    |
| `controls`   | ‚úì if `controls` attribute is present                                                       |
| `poster`     | ‚úì if `poster` attribute is set ¬∑ `(not set)` if missing                                   |
| `w/h`        | ‚úì if both `width` and `height` are set ¬∑ ‚ö†Ô∏è if missing (CLS risk)                         |
| `sources`    | Number of `<source>` child elements                                                        |
| `issues`     | ‚úÖ no issues ¬∑ üî¥ error ¬∑ ‚ö†Ô∏è warning ¬∑ ‚ÑπÔ∏è info                                            |

#### Issues Detected

| Issue                                            | Severity   | Explanation                                                                                |
| ------------------------------------------------ | ---------- | ------------------------------------------------------------------------------------------ |
| `preload="auto"` without `autoplay`              | üî¥ Error   | Browser downloads the entire video file on page load, wasting bandwidth                    |
| `autoplay` without `muted`                       | üî¥ Error   | All modern browsers block autoplay with audio ‚Äî the video will not play                    |
| `autoplay` without `playsinline`                 | ‚ö†Ô∏è Warning | iOS Safari switches to native fullscreen, breaking the intended layout                     |
| Off-viewport without `preload="none"`            | ‚ö†Ô∏è Warning | Browser may begin loading video data before the user scrolls to it                         |
| Missing `poster`                                 | ‚ö†Ô∏è Warning | No preview frame ‚Äî the element renders blank or black until the video loads                |
| Missing `width`/`height`                         | ‚ö†Ô∏è Warning | No reserved space causes layout shift when the video renders (CLS)                         |
| No modern codec source                           | ‚ÑπÔ∏è Info    | Serving only MP4/H.264 when VP9 or AV1 would reduce file size by 30‚Äì50 %                  |
| No `controls` and no `autoplay`                  | ‚ÑπÔ∏è Info    | Users have no visible way to start playback                                                |

#### Codec Detection

The snippet detects the best codec offered by the video by inspecting the `type` attribute of each `<source>` element in order of quality:

| Detected value | Source                                                                  |
| -------------- | ----------------------------------------------------------------------- |
| `AV1`          | `type` contains `av01` or `av1` codec string                            |
| `VP9`          | `type` contains `vp9` codec string                                      |
| `WebM`         | `type` contains `webm` or file URL ends in `.webm`                      |
| `MP4`          | `type` contains `mp4` or file URL ends in `.mp4` / `.mov`               |
| `OGG`          | `type` contains `ogg` or file URL ends in `.ogv`                        |
| `unknown`      | Sources exist but no recognisable type or extension                     |
| `no source`    | No `<source>` elements and no `src` attribute                           |

`AV1`, `VP9`, and `WebM` are treated as modern codecs and do not trigger the info note. Offering a modern codec as the first `<source>` lets browsers that support it avoid downloading the larger H.264 fallback.

#### `preload` Attribute Behaviour

| Value      | Browser behaviour                                                               |
| ---------- | ------------------------------------------------------------------------------- |
| `none`     | Nothing is fetched until the user interacts or JavaScript calls `load()`        |
| `metadata` | Only metadata is fetched: duration, dimensions, and the first frame             |
| `auto`     | Browser is permitted to download the full video file                            |
| (not set)  | Chrome/Firefox default to `metadata` on desktop and `none` on mobile            |

Being explicit avoids relying on browser defaults, which vary across devices and versions.

### Browser Support

| Feature           | Chrome | Edge | Firefox | Safari |
| ----------------- | ------ | ---- | ------- | ------ |
| `autoplay` + `muted` | 66  | 79   | 65      | 11     |
| `playsinline`     | 60     | 79   | ‚Äî       | 10     |
| `preload`         | 3      | 12   | 4       | 4      |
| `poster`          | 8      | 12   | 3.6     | 4      |
| VP9 (WebM)        | 29     | 14   | 28      | 14.1   |
| AV1               | 70     | 75   | 67      | 17     |

`playsinline` has no effect on desktop browsers ‚Äî it is a no-op outside of iOS Safari's fullscreen enforcement.

### Further Reading

- [Video performance](https://web.dev/learn/performance/video-performance) | web.dev
- [Optimizing Largest Contentful Paint](https://web.dev/articles/optimize-lcp) | web.dev
- [The `preload` attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video#preload) | MDN
- [Autoplay guide for media and Web Audio APIs](https://developer.mozilla.org/en-US/docs/Web/Media/Autoplay_guide) | MDN
- [AV1 codec](https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Video_codecs#av1) | MDN
- [Video and source elements](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/video) | MDN
